{
  "name": "HR6JO",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "send-dashboard-report",
        "responseMode": "lastNode",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "POST, OPTIONS"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -576,
        -384
      ],
      "id": "2db03e28-9405-40e0-96a7-b8e1d40802bd",
      "name": "Webhook",
      "webhookId": "9ec37e28-828c-4fa7-a0a7-875ccf5015cd",
      "notesInFlow": false
    },
    {
      "parameters": {
        "jsCode": "// n8n Code ë…¸ë“œ: HTML í˜•íƒœ ì´ë©”ì¼ ìƒì„±\n\nconst recipient = $input.first().json.body.recipient;\nconst reportData = $input.first().json.body.reportData || {};\nconst timestamp = new Date().toLocaleString('ko-KR');\n\n// HTML ì´ë©”ì¼ ë³¸ë¬¸ ìƒì„± (ì‹¤ì œ ëŒ€ì‹œë³´ë“œì™€ ìœ ì‚¬í•œ ìŠ¤íƒ€ì¼)\nconst htmlEmail = `\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>ê·¼ë¬´ë°ì´í„° ë¶„ì„ ë¦¬í¬íŠ¸</title>\n    <style>\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            line-height: 1.6;\n            color: #1f2937;\n            background-color: #f3f4f6;\n            margin: 0;\n            padding: 20px;\n        }\n        .container {\n            max-width: 800px;\n            margin: 0 auto;\n            background: white;\n            border-radius: 12px;\n            overflow: hidden;\n            box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n        }\n        .header {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 30px;\n            text-align: center;\n        }\n        .header h1 {\n            margin: 0 0 10px 0;\n            font-size: 2.2em;\n        }\n        .header p {\n            margin: 0;\n            opacity: 0.9;\n        }\n        .content {\n            padding: 30px;\n        }\n        .kpi-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n            gap: 20px;\n            margin-bottom: 30px;\n        }\n        .kpi-card {\n            background: #f8fafc;\n            border: 1px solid #e2e8f0;\n            border-radius: 8px;\n            padding: 20px;\n            text-align: center;\n        }\n        .kpi-value {\n            font-size: 2em;\n            font-weight: bold;\n            color: #3b82f6;\n            margin-bottom: 5px;\n        }\n        .kpi-label {\n            color: #64748b;\n            font-size: 0.9em;\n        }\n        .section {\n            margin-bottom: 30px;\n        }\n        .section h2 {\n            color: #1e293b;\n            border-bottom: 2px solid #e2e8f0;\n            padding-bottom: 10px;\n            margin-bottom: 20px;\n        }\n        .alert-danger {\n            background: #fef2f2;\n            border: 1px solid #fecaca;\n            border-left: 4px solid #ef4444;\n            padding: 20px;\n            border-radius: 6px;\n            margin: 20px 0;\n        }\n        .alert-success {\n            background: #f0fdf4;\n            border: 1px solid #bbf7d0;\n            border-left: 4px solid #22c55e;\n            padding: 20px;\n            border-radius: 6px;\n            margin: 20px 0;\n        }\n        .management-list {\n            list-style: none;\n            padding: 0;\n        }\n        .management-item {\n            background: #fff7ed;\n            border: 1px solid #fed7aa;\n            border-radius: 6px;\n            padding: 12px;\n            margin-bottom: 8px;\n            display: flex;\n            align-items: center;\n        }\n        .status-icon {\n            margin-right: 10px;\n            font-size: 1.2em;\n        }\n        .dept-stats {\n            background: #f8fafc;\n            border-radius: 8px;\n            padding: 15px;\n        }\n        .dept-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 8px 0;\n            border-bottom: 1px solid #e2e8f0;\n        }\n        .dept-item:last-child {\n            border-bottom: none;\n        }\n        .footer {\n            background: #f8fafc;\n            padding: 20px;\n            text-align: center;\n            color: #64748b;\n            font-size: 0.9em;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>ğŸ“Š ê·¼ë¬´ë°ì´í„° ë¶„ì„ ë¦¬í¬íŠ¸</h1>\n            <p>ìë™ ìƒì„± ë¦¬í¬íŠ¸ â€¢ ${timestamp}</p>\n        </div>\n        \n        <div class=\"content\">\n            ${generateKPISection(reportData.kpis)}\n            \n            ${generateDepartmentSection(reportData.departmentStats)}\n            \n            ${generateTeamSection(reportData.teamStats)}\n            \n            ${generateManagementSection(reportData.managementNeeded)}\n            \n            ${generateFiltersSection(reportData.filters)}\n        </div>\n        \n        <div class=\"footer\">\n            <p>ğŸ’¡ ì´ ë¦¬í¬íŠ¸ëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>\n            <p>â“ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì¸ì‚¬íŒ€ìœ¼ë¡œ ì—°ë½ì£¼ì„¸ìš”.</p>\n        </div>\n    </div>\n</body>\n</html>\n`;\n\n// KPI ì„¹ì…˜ ìƒì„± í•¨ìˆ˜\nfunction generateKPISection(kpis) {\n    if (!kpis || kpis.length === 0) {\n        return '<div class=\"section\"><h2>ğŸ“ˆ ì£¼ìš” ì§€í‘œ</h2><p>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';\n    }\n    \n    const kpiCards = kpis.map(kpi => `\n        <div class=\"kpi-card\">\n            <div class=\"kpi-value\">${kpi.value}</div>\n            <div class=\"kpi-label\">${kpi.label}</div>\n        </div>\n    `).join('');\n    \n    return `\n        <div class=\"section\">\n            <h2>ğŸ“ˆ ì£¼ìš” ì§€í‘œ</h2>\n            <div class=\"kpi-grid\">\n                ${kpiCards}\n            </div>\n        </div>\n    `;\n}\n\n// ë¶€ì„œë³„ í˜„í™© ì„¹ì…˜ ìƒì„± í•¨ìˆ˜\nfunction generateDepartmentSection(departmentStats) {\n    if (!departmentStats || departmentStats.length === 0) {\n        return '';\n    }\n    \n    const deptItems = departmentStats.map(dept => `\n        <div class=\"dept-item\">\n            <span><strong>${dept.department}&nbsp;&nbsp;</strong></span>\n            <span>${dept.avgHoursPerEmployee}ì‹œê°„</span>\n        </div>\n    `).join('');\n    \n    return `\n        <div class=\"section\">\n            <h2>ğŸ¢ ë¶€ì„œë³„ í‰ê·  ê·¼ë¬´ì‹œê°„</h2>\n            <div class=\"dept-stats\">\n                ${deptItems}\n            </div>\n        </div>\n    `;\n}\n\n// íŒ€ë³„ í˜„í™© ì„¹ì…˜ ìƒì„± í•¨ìˆ˜\nfunction generateTeamSection(teamStats) {\n    if (!teamStats || teamStats.length === 0) {\n        return '';\n    }\n    \n    const teamItems = teamStats.map(team => `\n        <div class=\"dept-item\">\n            <span><strong>${team.team}&nbsp;&nbsp;</strong></span>\n            <span>${team.avgHours}ì‹œê°„</span>\n        </div>\n    `).join('');\n    \n    return `\n        <div class=\"section\">\n            <h2>ğŸ‘¥ íŒ€ë³„ í‰ê·  ê·¼ë¬´ì‹œê°„</h2>\n            <div class=\"dept-stats\">\n                ${teamItems}\n            </div>\n        </div>\n    `;\n}\n\n// ê´€ë¦¬ í•„ìš” ëŒ€ìƒì ì„¹ì…˜ ìƒì„± í•¨ìˆ˜\nfunction generateManagementSection(managementNeeded) {\n    if (!managementNeeded || managementNeeded.length === 0) {\n        return `\n            <div class=\"alert-success\">\n                <h3 style=\"margin-top: 0; color: #166534;\">âœ… ê´€ë¦¬ í•„ìš” ëŒ€ìƒì ì—†ìŒ</h3>\n                <p style=\"margin-bottom: 0;\">í˜„ì¬ ê´€ë¦¬ê°€ í•„ìš”í•œ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤. ëª¨ë“  ì§ì›ì´ ì ì • ê·¼ë¬´ì‹œê°„ì„ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>\n            </div>\n        `;\n    }\n    \n    const managementItems = managementNeeded.slice(0, 10).map(emp => `\n        <li class=\"management-item\">\n            <span class=\"status-icon\">âš ï¸</span>\n            <div>\n                <strong>${emp.name || emp.empId || 'ì´ë¦„ì—†ìŒ'}</strong>\n                <span style=\"color: #64748b;\"> - ${emp.department || 'ë¶€ì„œì—†ìŒ'}</span>\n                <span style=\"color: #dc2626; font-weight: 500;\"> (${emp.workHours || 'ì‹œê°„ë¯¸ìƒ'})</span>\n                ${emp.reasons ? `<br><small style=\"color: #64748b;\">ì‚¬ìœ : ${emp.reasons}</small>` : ''}\n            </div>\n        </li>\n    `).join('');\n    \n    const extraCount = managementNeeded.length > 10 ? managementNeeded.length - 10 : 0;\n    \n    return `\n        <div class=\"alert-danger\">\n            <h3 style=\"margin-top: 0; color: #dc2626;\">âš ï¸ ê´€ë¦¬ í•„ìš” ëŒ€ìƒì (${managementNeeded.length}ëª…)</h3>\n            <ul class=\"management-list\">\n                ${managementItems}\n                ${extraCount > 0 ? `<li class=\"management-item\" style=\"background: #f3f4f6;\"><span class=\"status-icon\">ğŸ“‹</span><div>... ì™¸ ${extraCount}ëª… ë”</div></li>` : ''}\n            </ul>\n        </div>\n    `;\n}\n\n// í•„í„° ì„¹ì…˜ ìƒì„± í•¨ìˆ˜\nfunction generateFiltersSection(filters) {\n    if (!filters) return '';\n    \n    const activeFilters = [];\n    if (filters.department && filters.department !== 'ì „ì²´') activeFilters.push(`ë¶€ì„œ: ${filters.department}`);\n    if (filters.team && filters.team !== 'ì „ì²´') activeFilters.push(`íŒ€: ${filters.team}`);\n    if (filters.workType && filters.workType !== 'ì „ì²´') activeFilters.push(`ê·¼ë¬´ìœ í˜•: ${filters.workType}`);\n    if (filters.shift && filters.shift !== 'ì „ì²´') activeFilters.push(`ê·¼ë¬´ì¡°: ${filters.shift}`);\n    \n    if (activeFilters.length === 0) return '';\n    \n    return `\n        <div class=\"section\">\n            <h2>ğŸ” ì ìš©ëœ í•„í„°</h2>\n            <div style=\"background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 6px; padding: 15px;\">\n                ${activeFilters.map(filter => `<span style=\"background: #dbeafe; color: #1e40af; padding: 4px 8px; border-radius: 4px; margin-right: 8px; font-size: 0.9em;\">${filter}</span>`).join('')}\n            </div>\n        </div>\n    `;\n}\n\n// ì´ë©”ì¼ ì œëª© ìƒì„±\nconst managementCount = reportData.managementNeeded ? reportData.managementNeeded.length : 0;\nconst alertLevel = managementCount > 5 ? 'ğŸš¨ ê¸´ê¸‰' : managementCount > 0 ? 'âš ï¸ ì£¼ì˜' : 'âœ… ì–‘í˜¸';\nconst subject = `${alertLevel} ê·¼ë¬´ë¶„ì„ ë¦¬í¬íŠ¸ - ${new Date().toLocaleDateString('ko-KR')} (ê´€ë¦¬ëŒ€ìƒ: ${managementCount}ëª…)`;\n\n// ê²°ê³¼ ë°˜í™˜\nreturn {\n    to: recipient,\n    subject: subject,\n    body: htmlEmail,\n    isHtml: true  // HTML í˜•íƒœì„ì„ í‘œì‹œ\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -336,
        -384
      ],
      "id": "c0094a4a-e784-4369-9d21-f9d3693d50a1",
      "name": "Code_html"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Code_html').item.json.to }}",
        "subject": "={{ $('Code_html').item.json.subject }}",
        "message": "={{ $json.content[0].text + \"\\n\" + $('Code_html').item.json.body }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        256,
        -384
      ],
      "id": "18d93053-da2b-4769-8a29-687d7df1f35d",
      "name": "Send a message",
      "webhookId": "a830e800-ac42-4a7c-8df8-9a07dc351281",
      "credentials": {
        "gmailOAuth2": {
          "id": "ZfjS1aownJke4NPB",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "claude-sonnet-4-20250514",
          "mode": "list",
          "cachedResultName": "claude-sonnet-4-20250514"
        },
        "messages": {
          "values": [
            {
              "content": "=ì œê³µëœ ìë£Œì— ëŒ€í•´ì„œ HRì „ë¬¸ê°€ ì˜ê²¬ì´ í•„ìš”í•´.\n1. ê´€ë¦¬ê°€ í•„ìš”í•œ ì¸ì›ì´ ìˆë‹¤ë©´ ì˜ê²¬ì„ ì„¸ì¤„ë¡œ ì‘ì„±í•´ì¤˜, ì´ë•Œ í…ìŠ¤íŠ¸ë¡œë§Œ ê°„ë‹¨í•˜ê²Œ ì‘ì„±\n\nì•„ë˜ëŠ” ë¶„ì„ëœ ì½”ë“œ ë‚´ìš©ì´ì•¼.\n---\n{{ $json.body }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.anthropic",
      "typeVersion": 1,
      "position": [
        -128,
        -384
      ],
      "id": "459675f5-4593-470e-8686-3645f51ba5a5",
      "name": "Message a model",
      "credentials": {
        "anthropicApi": {
          "id": "L3RrHvP2BFqBBgkt",
          "name": "Anthropic account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Code_html",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code_html": {
      "main": [
        [
          {
            "node": "Message a model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "87d76914-bdde-4294-abf8-2557e9ddf3a5",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "b08f188d80f29f042aa6e1ac9ada6a920b74e5b44c574a46ee687bc313876758"
  },
  "id": "ni6MEoi6yCYIFpX3",
  "tags": []
}